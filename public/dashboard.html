<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Creative Intelligence Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { background-color: #8b5cf6; color: white; }
        .debug-panel {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border-radius: 8px;
            padding: 12px;
            margin-top: 20px;
        }
        .creative-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            background: white;
            margin-bottom: 16px;
        }
        .generated-creative {
            border: 2px solid #10b981;
            background: #f0fdf4;
        }
        .generation-progress {
            display: none;
            text-align: center;
            padding: 20px;
            background: #eff6ff;
            border-radius: 8px;
            margin: 20px 0;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6 mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold flex items-center">
                    ü§ñ AI-Powered Creative Intelligence
                </h1>
                <p class="text-purple-100 mt-1">Multi-platform analysis ‚Ä¢ AI creative insights ‚Ä¢ Real creative generation ‚Ä¢ Performance optimization</p>
            </div>
            <div class="text-right">
                <div class="text-sm text-purple-200">Cross-Platform ROAS</div>
                <div class="text-3xl font-bold" id="overallROAS">0.00x</div>
            </div>
        </div>
    </div>

    <!-- Platform Overview -->
    <div class="max-w-7xl mx-auto px-6 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Facebook Ads -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        üìò Facebook Ads
                    </h3>
                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Spend:</span>
                        <span class="font-semibold" id="fbSpend">¬£0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Conversions:</span>
                        <span class="font-semibold" id="fbConversions">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ROAS:</span>
                        <span class="font-semibold" id="fbROAS">0.00x</span>
                    </div>
                </div>
            </div>

            <!-- Taboola -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        üî∂ Taboola
                    </h3>
                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Spend:</span>
                        <span class="font-semibold" id="taboolaSpend">¬£0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Conversions:</span>
                        <span class="font-semibold" id="taboolaConversions">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ROAS:</span>
                        <span class="font-semibold" id="taboolaROAS">0.00x</span>
                    </div>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        üß† AI Insights
                    </h3>
                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Analyzed:</span>
                        <span class="font-semibold" id="aiAnalyzed">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Success Factors:</span>
                        <span class="font-semibold" id="aiSuccessFactors">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Generated:</span>
                        <span class="font-semibold" id="aiGenerated">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-6">
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6" aria-label="Tabs">
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm active" data-tab="overview">
                        üè† Overview
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm" data-tab="campaigns">
                        üìä Campaigns
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm" data-tab="creatives">
                        üé® Creative Analysis
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm" data-tab="video-analysis">
                        üì∫ Video Hook Analysis
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm" data-tab="ai-insights">
                        üß† AI Insights
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm" data-tab="creative-generator">
                        ‚ú® Creative Generator
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm" data-tab="testing">
                        üß™ Testing Lab
                    </button>
                </nav>
            </div>

            <!-- Creative Generator Tab -->
            <div id="creative-generator" class="tab-content p-6">
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-lg">
                        <h2 class="text-xl font-bold text-gray-800 mb-2">‚ú® AI Creative Generator</h2>
                        <p class="text-gray-600">Generate high-converting ad creatives using AI and your success factors</p>
                    </div>

                    <!-- Generation Controls -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Base Creative:</label>
                            <select id="baseCreativeSelect" class="w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="">Select a base creative...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Generation Type:</label>
                            <select id="generationTypeSelect" class="w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="variation">Create Variations</option>
                                <option value="style_transfer">Style Transfer</option>
                                <option value="concept_remix">Concept Remix</option>
                                <option value="platform_adaptation">Platform Adaptation</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Target Platform:</label>
                            <select id="targetPlatformSelect" class="w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="facebook">Facebook</option>
                                <option value="taboola">Taboola</option>
                                <option value="both">Both Platforms</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="generateCreativeBtn" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-2 px-4 rounded-md hover:from-purple-700 hover:to-blue-700 transition-colors">
                                üöÄ Generate with AI
                            </button>
                        </div>
                    </div>

                    <!-- Success Factors Display -->
                    <div id="successFactorsDisplay" class="bg-white border border-gray-200 rounded-lg p-4" style="display: none;">
                        <h3 class="font-semibold text-gray-800 mb-3">üéØ Success Factors to Apply:</h3>
                        <div id="successFactorsList" class="space-y-2"></div>
                    </div>

                    <!-- Generation Progress -->
                    <div id="generationProgress" class="generation-progress">
                        <div class="spinner"></div>
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">ü§ñ AI Creating Your Creatives...</h3>
                        <p class="text-blue-600" id="progressText">Analyzing success factors and generating variations...</p>
                        <div class="mt-4">
                            <div class="bg-blue-200 rounded-full h-2">
                                <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Generated Creatives -->
                    <div id="generatedCreatives" class="space-y-4"></div>

                    <!-- Instructions -->
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                        <h3 class="font-semibold text-blue-800 mb-2">üìã How to Use:</h3>
                        <ol class="list-decimal list-inside space-y-1 text-blue-700">
                            <li>First run <strong>AI Analysis</strong> on a high-performing creative to identify success factors</li>
                            <li>Select that creative as your <strong>Base Creative</strong></li>
                            <li>Choose your <strong>Generation Type</strong> and <strong>Target Platform</strong></li>
                            <li>Click <strong>Generate with AI</strong> to create new variations</li>
                            <li>Review generated creatives and launch A/B tests</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Other Tab Contents (simplified for focus) -->
            <div id="overview" class="tab-content p-6 active">
                <h2 class="text-xl font-bold mb-4">üìä Platform Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-lg border">
                        <h3 class="text-sm font-medium text-gray-500">Total Spend</h3>
                        <p class="text-2xl font-bold text-gray-900" id="totalSpendOverview">¬£0.00</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg border">
                        <h3 class="text-sm font-medium text-gray-500">Total Revenue</h3>
                        <p class="text-2xl font-bold text-gray-900" id="totalRevenueOverview">¬£0.00</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg border">
                        <h3 class="text-sm font-medium text-gray-500">Total Conversions</h3>
                        <p class="text-2xl font-bold text-gray-900" id="totalConversionsOverview">0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg border">
                        <h3 class="text-sm font-medium text-gray-500">Overall ROAS</h3>
                        <p class="text-2xl font-bold text-gray-900" id="overallROASOverview">0.00x</p>
                    </div>
                </div>
            </div>

            <div id="campaigns" class="tab-content p-6">
                <h2 class="text-xl font-bold mb-4">üìä Campaigns</h2>
                <div id="campaignsTable">Loading campaigns...</div>
            </div>

            <div id="creatives" class="tab-content p-6">
                <h2 class="text-xl font-bold mb-4">üé® Creative Analysis</h2>
                <div id="creativesGrid">Loading creatives...</div>
            </div>

            <div id="video-analysis" class="tab-content p-6">
                <h2 class="text-xl font-bold mb-4">üì∫ Video Hook Analysis</h2>
                <div id="videoAnalysisTable">Loading video analysis...</div>
            </div>

            <div id="ai-insights" class="tab-content p-6">
                <h2 class="text-xl font-bold mb-4">üß† AI Insights</h2>
                <div id="aiInsights">No AI insights available. Run creative analysis first.</div>
            </div>

            <div id="testing" class="tab-content p-6">
                <h2 class="text-xl font-bold mb-4">üß™ Testing Lab</h2>
                <p>Testing strategies and A/B test management coming soon!</p>
            </div>
        </div>
    </div>

    <!-- Debug Console -->
    <div class="max-w-7xl mx-auto px-6 mt-6">
        <div class="bg-white rounded-lg shadow-md p-4">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-semibold text-gray-800">üîß Debug Console</h3>
                <button onclick="clearDebugLog()" class="text-sm bg-gray-200 px-3 py-1 rounded">Clear</button>
            </div>
            <div id="debugLog" class="debug-panel">
                Dashboard loaded. Waiting for data...
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = window.location.origin;
        
        // Global data storage
        let allCampaigns = [];
        let allCreatives = [];
        let currentSuccessFactors = [];
        let overviewData = {};

        // Debug logging
        function debugLog(message) {
            const debugEl = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugEl.innerHTML += `${timestamp} ${message}: ${message}\n`;
            debugEl.scrollTop = debugEl.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }

        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        // Tab management
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');
                    
                    // Update button states
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update content visibility
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(targetTab).classList.add('active');
                    
                    debugLog(`Switched to ${targetTab} tab`);
                });
            });
        }

        // Initialize Creative Generator
        function initializeCreativeGenerator() {
            debugLog('Initializing Creative Generator...');
            
            const generateBtn = document.getElementById('generateCreativeBtn');
            const baseCreativeSelect = document.getElementById('baseCreativeSelect');
            
            if (!generateBtn) {
                debugLog('‚ùå Generate button not found!');
                return;
            }

            // Populate base creative dropdown
            populateBaseCreativeDropdown();
            
            // Add click event listener
            generateBtn.addEventListener('click', async () => {
                debugLog('üöÄ Generate button clicked!');
                await generateCreatives();
            });

            debugLog('‚úÖ Creative Generator initialized successfully');
        }

        function populateBaseCreativeDropdown() {
            const select = document.getElementById('baseCreativeSelect');
            if (!select) return;

            // Clear existing options
            select.innerHTML = '<option value="">Select a base creative...</option>';

            // Add mock options for testing
            const mockCreatives = [
                { id: 'fb_001', name: 'High CTR Facebook Ad (2.5%)', score: 250 },
                { id: 'tab_005', name: 'Top Taboola Creative (1.8%)', score: 200 },
                { id: 'fb_003', name: 'Conversion Winner (5 leads)', score: 180 }
            ];

            mockCreatives.forEach(creative => {
                const option = document.createElement('option');
                option.value = creative.id;
                option.textContent = `${creative.name} (Score: ${creative.score})`;
                select.appendChild(option);
            });

            debugLog(`‚úÖ Populated base creative dropdown with ${mockCreatives.length} options`);
        }

        async function generateCreatives() {
            debugLog('üé® Starting creative generation process...');
            
            try {
                const baseCreativeId = document.getElementById('baseCreativeSelect').value;
                const generationType = document.getElementById('generationTypeSelect').value;
                const targetPlatform = document.getElementById('targetPlatformSelect').value;

                if (!baseCreativeId) {
                    alert('Please select a base creative first');
                    debugLog('‚ùå No base creative selected');
                    return;
                }

                // Show progress
                showGenerationProgress();

                // Prepare request data
                const requestData = {
                    base_creative_id: baseCreativeId,
                    generation_type: generationType,
                    target_platform: targetPlatform,
                    success_factors: currentSuccessFactors,
                    creative_format: 'image'
                };

                debugLog(`üì§ Sending generation request: ${JSON.stringify(requestData)}`);

                // Call API
                const response = await fetch(`${API_BASE}/api/real-creative-generator`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                debugLog(`üì• API response status: ${response.status}`);

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();
                debugLog(`‚úÖ Generation completed: ${result.generated_count} creatives created`);
                debugLog(`Services used: ${result.services_used?.join(', ')}`);

                // Hide progress and show results
                hideGenerationProgress();
                displayGeneratedCreatives(result.creatives);

                // Update AI insights counter
                document.getElementById('aiGenerated').textContent = result.generated_count;

            } catch (error) {
                debugLog(`‚ùå Generation error: ${error.message}`);
                hideGenerationProgress();
                alert(`Generation failed: ${error.message}`);
            }
        }

        function showGenerationProgress() {
            const progressEl = document.getElementById('generationProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressEl.style.display = 'block';
            
            // Animate progress bar
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 90) progress = 90;
                
                progressBar.style.width = `${progress}%`;
                
                if (progress < 30) {
                    progressText.textContent = 'Analyzing success factors...';
                } else if (progress < 60) {
                    progressText.textContent = 'Generating AI creatives...';
                } else {
                    progressText.textContent = 'Finalizing variations...';
                }
                
                if (progress >= 90) {
                    clearInterval(interval);
                }
            }, 500);
            
            // Store interval for cleanup
            progressEl.setAttribute('data-interval', interval);
        }

        function hideGenerationProgress() {
            const progressEl = document.getElementById('generationProgress');
            const interval = progressEl.getAttribute('data-interval');
            
            if (interval) {
                clearInterval(parseInt(interval));
            }
            
            // Complete progress bar
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('progressText').textContent = 'Generation complete!';
            
            setTimeout(() => {
                progressEl.style.display = 'none';
            }, 1000);
        }

        function displayGeneratedCreatives(creatives) {
            const container = document.getElementById('generatedCreatives');
            
            if (!creatives || creatives.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 p-8">No creatives generated. Check the debug console for details.</div>';
                return;
            }

            let html = '<h3 class="text-lg font-semibold text-gray-800 mb-4">üé® Generated Creatives</h3>';
            
            creatives.forEach((creative, index) => {
                html += `
                    <div class="creative-card generated-creative">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="font-semibold text-gray-800">${creative.name}</h4>
                                <div class="text-sm text-gray-600 mt-1">
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                                        Generated with ${creative.generation_method}
                                    </span>
                                    <span class="ml-2">Target: ${creative.target_platform}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-600">Confidence</div>
                                <div class="text-lg font-bold text-green-600">
                                    ${Math.round((creative.performance_prediction?.confidence || 0.75) * 100)}%
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-medium text-gray-700 mb-2">Generated Content:</h5>
                                ${renderCreativeContent(creative.content)}
                            </div>
                            <div>
                                <h5 class="font-medium text-gray-700 mb-2">Performance Prediction:</h5>
                                <div class="space-y-1 text-sm">
                                    <div>Expected CTR: <span class="font-medium">${creative.performance_prediction?.expected_ctr_range || '1.5-2.5%'}</span></div>
                                    <div>Performance: <span class="font-medium capitalize">${creative.performance_prediction?.expected_performance || 'medium'}</span></div>
                                    <div>Budget: <span class="font-medium">${creative.testing_strategy?.recommended_budget || '¬£25-50'}</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 flex space-x-2">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">
                                üöÄ Launch Test
                            </button>
                            <button class="bg-gray-200 text-gray-800 px-4 py-2 rounded text-sm hover:bg-gray-300">
                                üì• Download
                            </button>
                            <button class="bg-purple-600 text-white px-4 py-2 rounded text-sm hover:bg-purple-700">
                                üîÑ Create Variations
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            debugLog(`‚úÖ Displayed ${creatives.length} generated creatives`);
        }

        function renderCreativeContent(content) {
            if (!content) return '<div class="text-gray-500">No content generated</div>';
            
            if (content.type === 'generated_image') {
                return `
                    <div class="space-y-2">
                        <img src="${content.image_url}" alt="Generated creative" class="w-full max-w-sm rounded-lg border">
                        <a href="${content.download_url}" target="_blank" class="inline-block text-blue-600 text-sm">üì• Download Image</a>
                    </div>
                `;
            } else if (content.type === 'creative_concept') {
                return `
                    <div class="bg-gray-50 p-3 rounded text-sm">
                        <strong>Creative Concept:</strong><br>
                        ${content.concept ? content.concept.substring(0, 200) + '...' : 'Concept generated'}
                    </div>
                `;
            } else if (content.type === 'detailed_brief') {
                return `
                    <div class="bg-blue-50 p-3 rounded text-sm">
                        <strong>${content.title}</strong><br>
                        ${content.concept}<br>
                        <div class="mt-2 text-xs text-gray-600">
                            Style: ${content.visual_direction?.recommended_style || 'Professional'}
                        </div>
                    </div>
                `;
            }
            
            return '<div class="text-gray-500">Content type not recognized</div>';
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Page loaded, initializing dashboard...');
            
            initializeTabs();
            initializeCreativeGenerator();
            
            // Add some mock success factors for testing
            currentSuccessFactors = [
                { factor: 'Eye-catching visuals', category: 'visual', impact_score: 0.8 },
                { factor: 'Strong emotional hook', category: 'psychological', impact_score: 0.7 },
                { factor: 'Clear value proposition', category: 'textual', impact_score: 0.9 }
            ];
            
            debugLog('‚úÖ Dashboard initialization complete');
        });
    </script>
</body>
</html>
