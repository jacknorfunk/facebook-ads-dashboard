<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voluum Endpoint Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .console {
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 11px;
        }
        .btn { background: #3b82f6; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; margin: 0.25rem; }
        .btn:hover { background: #2563eb; }
        .btn-green { background: #10b981; } .btn-green:hover { background: #059669; }
        .btn-red { background: #ef4444; } .btn-red:hover { background: #dc2626; }
        .btn-yellow { background: #f59e0b; } .btn-yellow:hover { background: #d97706; }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">Voluum Endpoint Finder</h1>
        <p class="text-gray-600 mb-6">Let's test different Voluum API endpoints to find what works</p>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Test 1: Campaign List Endpoint -->
            <div class="bg-white rounded-lg p-4">
                <h2 class="font-semibold mb-2">1. Campaign List Endpoint</h2>
                <button class="btn btn-green" onclick="testCampaignList()">Test /campaign</button>
                <div id="campaignListResult" class="console mt-2">Click to test campaign list...</div>
            </div>

            <!-- Test 2: Report with Basic Params -->
            <div class="bg-white rounded-lg p-4">
                <h2 class="font-semibold mb-2">2. Basic Report</h2>
                <button class="btn" onclick="testBasicReport()">Test /report (basic)</button>
                <div id="basicReportResult" class="console mt-2">Click to test basic report...</div>
            </div>

            <!-- Test 3: Report with Campaign Grouping -->
            <div class="bg-white rounded-lg p-4">
                <h2 class="font-semibold mb-2">3. Grouped Report</h2>
                <button class="btn btn-yellow" onclick="testGroupedReport()">Test /report (grouped)</button>
                <div id="groupedReportResult" class="console mt-2">Click to test grouped report...</div>
            </div>

            <!-- Test 4: Report with Minimal Params -->
            <div class="bg-white rounded-lg p-4">
                <h2 class="font-semibold mb-2">4. Minimal Report</h2>
                <button class="btn btn-red" onclick="testMinimalReport()">Test /report (minimal)</button>
                <div id="minimalReportResult" class="console mt-2">Click to test minimal report...</div>
            </div>

            <!-- Test 5: Different Date Formats -->
            <div class="bg-white rounded-lg p-4">
                <h2 class="font-semibold mb-2">5. Date Format Test</h2>
                <button class="btn" onclick="testDateFormats()">Test Date Formats</button>
                <div id="dateFormatResult" class="console mt-2">Click to test date formats...</div>
            </div>

            <!-- Test 6: Profile/Account Info -->
            <div class="bg-white rounded-lg p-4">
                <h2 class="font-semibold mb-2">6. Account Info</h2>
                <button class="btn btn-green" onclick="testAccountInfo()">Test /profile</button>
                <div id="accountInfoResult" class="console mt-2">Click to test account info...</div>
            </div>
        </div>

        <!-- Results Summary -->
        <div class="mt-6 bg-white rounded-lg p-4">
            <h2 class="font-semibold mb-2">Working Endpoints Summary</h2>
            <div id="summary" class="text-gray-600">Run tests above to see which endpoints work...</div>
        </div>
    </div>

    <script>
        let workingEndpoints = [];

        function log(elementId, message) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.textContent += `[${timestamp}] ${message}\n`;
            element.scrollTop = element.scrollHeight;
        }

        function clear(elementId) {
            document.getElementById(elementId).textContent = '';
        }

        // Test different endpoints through our API
        async function makeAPICall(endpoint, description, resultId) {
            log(resultId, `Testing: ${description}`);
            log(resultId, `Endpoint: ${endpoint}`);
            
            try {
                const response = await fetch(endpoint);
                log(resultId, `Status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(resultId, `‚úÖ SUCCESS!`);
                    log(resultId, `Response: ${JSON.stringify(data, null, 2).substring(0, 500)}...`);
                    
                    if (data.success && data.campaigns && data.campaigns.length > 0) {
                        log(resultId, `üéâ FOUND ${data.campaigns.length} CAMPAIGNS!`);
                        workingEndpoints.push({ endpoint, description, campaigns: data.campaigns.length });
                    } else if (data.success) {
                        log(resultId, `‚úÖ Endpoint works but 0 campaigns returned`);
                        workingEndpoints.push({ endpoint, description, campaigns: 0 });
                    }
                } else {
                    const errorData = await response.json();
                    log(resultId, `‚ùå FAILED: ${response.status}`);
                    log(resultId, `Error: ${JSON.stringify(errorData, null, 2).substring(0, 300)}...`);
                }
            } catch (error) {
                log(resultId, `‚ùå ERROR: ${error.message}`);
            }
            
            updateSummary();
        }

        // 1. Test campaign list endpoint
        async function testCampaignList() {
            clear('campaignListResult');
            await makeAPICall('/api/voluum/test-campaign-list', 'Direct campaign list (/campaign)', 'campaignListResult');
        }

        // 2. Test basic report
        async function testBasicReport() {
            clear('basicReportResult');
            const today = new Date().toISOString().split('T')[0];
            const lastWeek = new Date(Date.now() - 7*24*60*60*1000).toISOString().split('T')[0];
            await makeAPICall(`/api/voluum/campaigns?range=last7days`, 'Current campaigns API (last 7 days)', 'basicReportResult');
        }

        // 3. Test grouped report
        async function testGroupedReport() {
            clear('groupedReportResult');
            await makeAPICall('/api/voluum/campaigns?range=last30days', 'Current campaigns API (last 30 days)', 'groupedReportResult');
        }

        // 4. Test minimal report
        async function testMinimalReport() {
            clear('minimalReportResult');
            await makeAPICall('/api/voluum/test-minimal-report', 'Minimal report endpoint', 'minimalReportResult');
        }

        // 5. Test different date formats
        async function testDateFormats() {
            clear('dateFormatResult');
            
            const tests = [
                '/api/voluum/campaigns?range=yesterday',
                '/api/voluum/campaigns?range=last7days', 
                '/api/voluum/campaigns?range=last30days',
                '/api/voluum/campaigns?range=last90days'
            ];
            
            for (const endpoint of tests) {
                await makeAPICall(endpoint, `Date range test: ${endpoint.split('=')[1]}`, 'dateFormatResult');
                await new Promise(resolve => setTimeout(resolve, 1000)); // Wait between calls
            }
        }

        // 6. Test account info
        async function testAccountInfo() {
            clear('accountInfoResult');
            await makeAPICall('/api/voluum/test-profile', 'Profile/account info', 'accountInfoResult');
        }

        function updateSummary() {
            const summary = document.getElementById('summary');
            
            if (workingEndpoints.length === 0) {
                summary.innerHTML = '<p class="text-gray-500">No working endpoints found yet...</p>';
                return;
            }
            
            let html = '<div class="space-y-2">';
            workingEndpoints.forEach(endpoint => {
                const icon = endpoint.campaigns > 0 ? 'üéâ' : '‚úÖ';
                const campaignText = endpoint.campaigns > 0 ? ` (${endpoint.campaigns} campaigns!)` : ' (0 campaigns)';
                html += `<div class="p-2 bg-green-50 border border-green-200 rounded">
                    ${icon} <strong>${endpoint.description}</strong>${campaignText}
                    <br><code class="text-xs text-gray-600">${endpoint.endpoint}</code>
                </div>`;
            });
            html += '</div>';
            
            // Add recommendation
            const withData = workingEndpoints.filter(e => e.campaigns > 0);
            if (withData.length > 0) {
                html += `<div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded">
                    <strong>üéØ SOLUTION FOUND!</strong><br>
                    Use this endpoint: <code>${withData[0].endpoint}</code><br>
                    It returned ${withData[0].campaigns} campaigns with data!
                </div>`;
            } else if (workingEndpoints.length > 0) {
                html += `<div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                    <strong>‚ö†Ô∏è Endpoints work but no campaign data found</strong><br>
                    This suggests your Voluum account may not have campaigns with data in the tested date ranges.
                </div>`;
            }
            
            summary.innerHTML = html;
        }

        // Auto-run basic test
        setTimeout(() => {
            testBasicReport();
        }, 1000);
    </script>
</body>
</html>
